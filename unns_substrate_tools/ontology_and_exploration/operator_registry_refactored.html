<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>UNNS Operator Registry ‚Äî Attractor Taxonomy (Phase-B)</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: 'Consolas', 'Monaco', monospace; 
      background: #0a0a0a; 
      color: #e0e0e0; 
      line-height: 1.6;
    }
    .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
    
    /* Header */
    header { 
      text-align: center; 
      margin-bottom: 30px; 
      padding: 30px 20px; 
      border-bottom: 2px solid #2a2a2a; 
    }
    h1 { 
      font-size: 2em; 
      color: #4a9eff; 
      letter-spacing: 2px; 
      margin-bottom: 10px;
    }
    .subtitle { 
      color: #888; 
      font-size: 0.9em; 
      margin-top: 10px;
    }
    
    /* System Selector Panel */
    .panel { 
      background: #1a1a1a; 
      border: 1px solid #2a2a2a; 
      border-radius: 8px; 
      padding: 20px; 
      margin-bottom: 20px; 
    }
    .panel-title { 
      font-size: 1.2em; 
      color: #4a9eff; 
      margin-bottom: 15px; 
      padding-bottom: 10px; 
      border-bottom: 1px solid #2a2a2a; 
    }
    
    select {
      width: 100%;
      background: #0a0a0a;
      border: 1px solid #3a3a3a;
      color: #e0e0e0;
      padding: 12px;
      border-radius: 4px;
      font-family: inherit;
      font-size: 1em;
      cursor: pointer;
    }
    select:focus {
      outline: none;
      border-color: #4a9eff;
    }
    
    /* Filter Buttons */
    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .filter-btn {
      background: #0a0a0a;
      border: 1px solid #3a3a3a;
      color: #888;
      padding: 8px 16px;
      border-radius: 4px;
      font-family: inherit;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.2s;
    }
    .filter-btn:hover {
      border-color: #4a9eff;
      color: #4a9eff;
    }
    .filter-btn.active {
      background: #2a4a7a;
      border-color: #4a9eff;
      color: #e0e0e0;
    }
    
    /* Export Button */
    .export-btn {
      background: #2a4a2a;
      border: 1px solid #4aff4a;
      color: #4aff4a;
      padding: 10px 20px;
      border-radius: 4px;
      font-family: inherit;
      cursor: pointer;
      margin-top: 10px;
      transition: all 0.2s;
    }
    .export-btn:hover {
      background: #3a5a3a;
    }
    
    /* Warning Banner */
    .warning-banner {
      background: #2a1a1a;
      border: 2px solid #ff4a4a;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
      display: none;
    }
    .warning-banner.active {
      display: block;
    }
    .warning-title {
      color: #ff4a9e;
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 8px;
    }
    .warning-text {
      color: #aaa;
      font-size: 0.95em;
    }
    
    /* Operator Timeline */
    .timeline-container {
      background: #1a1a1a;
      border: 1px solid #2a2a2a;
      border-radius: 8px;
      padding: 30px 20px;
      margin: 20px 0;
    }
    .timeline {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      position: relative;
    }
    .timeline-line {
      position: absolute;
      top: 30px;
      left: 5%;
      right: 5%;
      height: 2px;
      background: #2a2a2a;
      z-index: 0;
    }
    .stage {
      flex: 1;
      text-align: center;
      position: relative;
      z-index: 1;
    }
    .stage-node {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: #0a0a0a;
      border: 3px solid #3a3a3a;
      margin: 0 auto 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2em;
      font-weight: bold;
      color: #888;
      transition: all 0.3s;
    }
    .stage-node.phi { border-color: #4a9eff; color: #4a9eff; }
    .stage-node.psi { border-color: #9e4aff; color: #9e4aff; }
    .stage-node.tau { border-color: #ff4a9e; color: #ff4a9e; }
    .stage-node.xii { 
      border-color: #4aff4a; 
      color: #4aff4a; 
      border-width: 4px;
      box-shadow: 0 0 20px rgba(74, 255, 74, 0.3);
    }
    .stage-node.msc { border-color: #ffa54a; color: #ffa54a; }
    
    .stage-label {
      font-size: 0.85em;
      color: #888;
      text-transform: uppercase;
      letter-spacing: 1px;
    }
    
    /* Stage Details */
    .stage-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-top: 20px;
    }
    @media (max-width: 900px) {
      .stage-details { grid-template-columns: 1fr; }
    }
    
    .detail-card {
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      border-radius: 4px;
      padding: 15px;
    }
    .detail-card.xii {
      grid-column: 1 / -1;
      border-color: #4aff4a;
      background: #0a1a0a;
    }
    .detail-header {
      font-size: 1em;
      font-weight: bold;
      margin-bottom: 10px;
      padding-bottom: 8px;
      border-bottom: 1px solid #2a2a2a;
    }
    .detail-header.phi { color: #4a9eff; }
    .detail-header.psi { color: #9e4aff; }
    .detail-header.tau { color: #ff4a9e; }
    .detail-header.xii { color: #4aff4a; }
    
    .detail-content {
      color: #aaa;
      font-size: 0.95em;
    }
    .detail-content strong {
      color: #e0e0e0;
    }
    
    /* Collapse Summary */
    .collapse-summary {
      background: #1a2a1a;
      border: 2px solid #4aff4a;
      border-radius: 4px;
      padding: 20px;
      margin: 20px 0;
    }
    .collapse-title {
      color: #4aff4a;
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .collapse-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 10px 20px;
    }
    .collapse-label {
      color: #888;
      font-weight: bold;
    }
    .collapse-value {
      color: #e0e0e0;
    }
    .collapse-value.survivor {
      color: #4aff4a;
      font-weight: bold;
      font-size: 1.1em;
    }
    .collapse-value.destroyed {
      color: #ff4a4a;
    }
    
    /* œÑ-MSC Classification */
    .msc-classification {
      background: #1a1a2a;
      border: 2px solid #ffa54a;
      border-radius: 4px;
      padding: 20px;
      margin: 20px 0;
    }
    .msc-title {
      color: #ffa54a;
      font-size: 1.2em;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .msc-badge {
      display: inline-block;
      padding: 10px 20px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 1.1em;
      margin-bottom: 15px;
    }
    .msc-badge.convergent { background: #2a4a2a; color: #4aff4a; }
    .msc-badge.chaotic { background: #4a3a2a; color: #ffa54a; }
    .msc-badge.fractal { background: #2a2a4a; color: #9e4aff; }
    .msc-badge.undecidable { background: #4a2a2a; color: #ff4a4a; }
    .msc-badge.geometric { background: #2a4a4a; color: #4a9eff; }
    .msc-badge.computational { background: #3a3a2a; color: #ffff4a; }
    .msc-badge.non-collapsing { background: #2a2a2a; color: #888; }
    
    .msc-description {
      color: #aaa;
      margin-top: 10px;
    }
    
    /* Cross-References */
    .cross-references {
      background: #1a1a2a;
      border: 1px solid #3a3a5a;
      border-radius: 4px;
      padding: 20px;
      margin: 20px 0;
    }
    .cross-ref-title {
      color: #9e4aff;
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 15px;
    }
    .cross-ref-group {
      margin-bottom: 15px;
    }
    .cross-ref-group:last-child {
      margin-bottom: 0;
    }
    .cross-ref-label {
      color: #888;
      font-size: 0.9em;
      margin-bottom: 8px;
      font-weight: bold;
    }
    .cross-ref-links {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .cross-ref-link {
      background: #0a0a1a;
      border: 1px solid #4a4a6a;
      color: #9e4aff;
      padding: 6px 12px;
      border-radius: 4px;
      text-decoration: none;
      font-size: 0.9em;
      cursor: pointer;
      transition: all 0.2s;
    }
    .cross-ref-link:hover {
      background: #2a2a4a;
      border-color: #9e4aff;
    }
    .cross-ref-none {
      color: #666;
      font-style: italic;
      font-size: 0.9em;
    }
    
    /* System Info */
    .system-info {
      background: #0a0a0a;
      border: 1px solid #2a2a2a;
      border-radius: 4px;
      padding: 15px;
      margin: 20px 0;
    }
    .system-info-title {
      color: #4a9eff;
      font-size: 1.1em;
      margin-bottom: 10px;
    }
    .info-grid {
      display: grid;
      grid-template-columns: auto 1fr;
      gap: 8px 15px;
    }
    .info-label {
      color: #888;
    }
    .info-value {
      color: #e0e0e0;
    }
    
    /* Placeholder */
    .placeholder {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    .placeholder-icon {
      font-size: 3em;
      margin-bottom: 20px;
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 30px 20px;
      margin-top: 40px;
      border-top: 1px solid #2a2a2a;
      color: #666;
      font-size: 0.85em;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>‚öôÔ∏è UNNS OPERATOR REGISTRY</h1>
      <div class="subtitle">Attractor Taxonomy (Phase-B) ‚Äî Œ¶‚ÜíŒ®‚ÜíœÑ‚ÜíXII‚ÜíœÑ-MSC Pipeline</div>
    </header>
    
    <div class="panel">
      <div class="panel-title">System Selection</div>
      <select id="systemSelector">
        <option value="">‚Äî Select a System ‚Äî</option>
      </select>
    </div>
    
    <div class="panel">
      <div class="panel-title">Classification Filter (œÑ-MSC)</div>
      <div id="mscFilter" class="filter-buttons">
        <button class="filter-btn active" data-filter="all">All Systems</button>
        <button class="filter-btn" data-filter="CONVERGENT_ATTRACTOR">Convergent</button>
        <button class="filter-btn" data-filter="CHAOTIC_SURVIVOR">Chaotic</button>
        <button class="filter-btn" data-filter="FRACTAL_SURVIVOR">Fractal</button>
        <button class="filter-btn" data-filter="GEOMETRIC">Geometric</button>
        <button class="filter-btn" data-filter="UNDECIDABLE_OPEN">Undecidable</button>
        <button class="filter-btn" data-filter="OTHER">Other</button>
      </div>
    </div>
    
    <div id="warningBanner" class="warning-banner">
      <div class="warning-title">‚ö†Ô∏è Research Context Required</div>
      <div class="warning-text">
        This system exhibits unresolved or observer-dependent collapse behavior. 
        Operator XII outcome is empirical or structurally unproven.
      </div>
    </div>
    
    <main id="output">
      <div class="placeholder">
        <div class="placeholder-icon">‚öôÔ∏è</div>
        <div>Select a system above to view its operator decomposition</div>
      </div>
    </main>
    
    <footer>
      <strong>UNNS Operator Registry v2.0</strong> | Phase-B Certified | 
      Interpretive Taxonomy (Non-Experimental) | 
      Framework: Œ¶‚ÄìŒ®‚ÄìœÑ Pipeline + Operator XII Collapse + œÑ-MSC Classification
    </footer>
  </div>
  
  <script>
// ============================================================================
// UNNS OPERATOR REGISTRY ‚Äî DATA MODEL
// ============================================================================

const OPERATOR_REGISTRY = {
  version: "2.0",
  framework: "UNNS Operator Registry",
  systems: [
    {
      id: "fibonacci",
      title: "Fibonacci Sequence",
      phi: "Linear additive recursion from two seeds",
      psi: "Ratio stabilization between successive terms",
      tau: "Strong damping; curvature flattens rapidly",
      operator_xii: {
        type: "Invariant collapse",
        survivor: "œÜ ‚âà 1.618033988749895",
        destroyed: ["Initial seed values", "Absolute magnitudes"]
      },
      tau_msc: "CONVERGENT_ATTRACTOR",
      public: true
    },
    {
      id: "lucas",
      title: "Lucas Numbers",
      phi: "Linear additive recursion (shifted seeds from Fibonacci)",
      psi: "Same ratio stabilization as Fibonacci",
      tau: "Strong damping",
      operator_xii: {
        type: "Seed information destroyed",
        survivor: "œÜ ‚âà 1.618033988749895",
        destroyed: ["Initial conditions", "Distinction from Fibonacci"]
      },
      tau_msc: "CONVERGENT_ATTRACTOR",
      public: true
    },
    {
      id: "tribonacci",
      title: "Tribonacci Sequence",
      phi: "Triadic additive recursion (3-term generative kernel)",
      psi: "Higher-order ratio stabilization",
      tau: "Moderate damping; slower flattening than Fibonacci",
      operator_xii: {
        type: "Dominant root selection",
        survivor: "œà ‚âà 1.839286755214161",
        destroyed: ["Secondary roots", "Oscillatory components"]
      },
      tau_msc: "CONVERGENT_ATTRACTOR",
      public: true
    },
    {
      id: "pell",
      title: "Pell Numbers",
      phi: "Weighted linear recursion: P(n) = 2P(n‚àí1) + P(n‚àí2)",
      psi: "Ratio stabilization under weighted growth",
      tau: "Strong curvature bias toward dominant mode",
      operator_xii: {
        type: "Invariant collapse",
        survivor: "1 + ‚àö2 ‚âà 2.414213562373095",
        destroyed: ["Initial condition memory"]
      },
      tau_msc: "CONVERGENT_ATTRACTOR",
      public: true
    },
    {
      id: "padovan",
      title: "Padovan Sequence",
      phi: "Delayed additive recursion: P(n) = P(n‚àí2) + P(n‚àí3)",
      psi: "Non-adjacent dependency structure",
      tau: "Moderate damping",
      operator_xii: {
        type: "Dominant root selection",
        survivor: "œÅ ‚âà 1.324717957244746 (Plastic number)",
        destroyed: ["Oscillatory modes", "Transient components"]
      },
      tau_msc: "CONVERGENT_ATTRACTOR",
      public: true
    },
    {
      id: "catalan",
      title: "Catalan Numbers",
      phi: "Recursive combinatorial expansion",
      psi: "Structural balance constraints",
      tau: "Weak damping (superlinear growth)",
      operator_xii: {
        type: "Structural retention (growth law)",
        survivor: "Asymptotic growth form: C(n) ~ 4‚Åø / (n^(3/2) ‚àöœÄ)",
        destroyed: ["Exact enumeration details"]
      },
      tau_msc: "STRUCTURAL_SURVIVOR",
      public: true
    },
    {
      id: "euler",
      title: "Euler's Number (e)",
      phi: "Iterative limit recursion: e = lim(n‚Üí‚àû) (1 + 1/n)‚Åø",
      psi: "Multiplicative stabilization",
      tau: "Strong curvature flattening",
      operator_xii: {
        type: "Scalar invariant collapse",
        survivor: "e ‚âà 2.718281828459045",
        destroyed: ["Discretization path", "Finite approximations"]
      },
      tau_msc: "CONVERGENT_ATTRACTOR",
      public: true
    },
    {
      id: "logistic_stable",
      title: "Logistic Map (Stable Regime, Œº < Œº_crit)",
      phi: "Nonlinear bounded recursion: x(n+1) = Œºx(n)(1 ‚àí x(n))",
      psi: "Fixed-point stability",
      tau: "Strong damping toward fixed point",
      operator_xii: {
        type: "Fixed-point retention",
        survivor: "Stable x* = 1 ‚àí 1/Œº",
        destroyed: ["Initial condition memory", "Transient dynamics"]
      },
      tau_msc: "CONVERGENT_ATTRACTOR",
      public: true
    },
    {
      id: "logistic_chaotic",
      title: "Logistic Map (Chaotic Regime, Œº > Œº_crit)",
      phi: "Nonlinear bounded recursion (same generator)",
      psi: "Bifurcation structure breakdown",
      tau: "Oscillatory curvature; no fixed damping",
      operator_xii: {
        type: "Chaos retention (bounded)",
        survivor: "Chaotic attractor (bounded region)",
        destroyed: ["Periodicity", "Predictability"]
      },
      tau_msc: "CHAOTIC_SURVIVOR",
      public: true
    },
    {
      id: "feigenbaum",
      title: "Feigenbaum Map (Bifurcation Cascade)",
      phi: "Recursive bifurcation cascade generator",
      psi: "Period-doubling structure",
      tau: "Self-similar curvature at all scales",
      operator_xii: {
        type: "Scale-invariant collapse",
        survivor: "Œ¥ ‚âà 4.669201609102990 (Feigenbaum constant)",
        destroyed: ["Absolute scale", "Specific bifurcation levels"]
      },
      tau_msc: "UNIVERSAL_ATTRACTOR",
      public: true
    },
    {
      id: "henon",
      title: "H√©non Map",
      phi: "Coupled nonlinear recursion: x(n+1) = 1 ‚àí ax(n)¬≤ + y(n), y(n+1) = bx(n)",
      psi: "Phase-space folding",
      tau: "Persistent curvature; chaotic mixing",
      operator_xii: {
        type: "Chaos retention (strange attractor)",
        survivor: "Strange attractor (bounded fractal structure)",
        destroyed: ["Initial condition memory", "Smooth manifolds"]
      },
      tau_msc: "CHAOTIC_SURVIVOR",
      public: true
    },
    {
      id: "mandelbrot",
      title: "Mandelbrot Set",
      phi: "Meta-recursion over Julia systems: z(n+1) = z(n)¬≤ + c",
      psi: "Stability classification of parameter space",
      tau: "Infinite boundary curvature",
      operator_xii: {
        type: "Boundedness filter",
        survivor: "Bounded parameter set (Mandelbrot boundary)",
        destroyed: ["Divergent parameters", "Escaping orbits"]
      },
      tau_msc: "META_ATTRACTOR",
      public: true
    },
    {
      id: "julia",
      title: "Julia Set",
      phi: "Complex quadratic recursion: z(n+1) = z(n)¬≤ + c (fixed c)",
      psi: "Boundary formation between bounded/unbounded",
      tau: "Infinite curvature at Julia boundary",
      operator_xii: {
        type: "Bounded region retention",
        survivor: "Julia boundary (fractal set)",
        destroyed: ["Escaping points", "Interior uniformity"]
      },
      tau_msc: "FRACTAL_SURVIVOR",
      public: true
    },
    {
      id: "golden_angle",
      title: "Golden Angle Spiral (Phyllotaxis)",
      phi: "Angular recursive placement: Œ∏(n) = n √ó 137.5¬∞",
      psi: "Irrational rotation invariance",
      tau: "Optimal packing (minimal overlap)",
      operator_xii: {
        type: "Angle retention",
        survivor: "œÜ-based angle ‚âà 137.508¬∞ (360¬∞/œÜ¬≤)",
        destroyed: ["Absolute scale", "Radial function"]
      },
      tau_msc: "GEOMETRIC_ATTRACTOR",
      public: true
    },
    {
      id: "archimedean",
      title: "Archimedean Spiral",
      phi: "Linear angular recursion: r = aŒ∏",
      psi: "Uniform spacing (constant growth)",
      tau: "No damping; unbounded growth",
      operator_xii: {
        type: "No collapse (non-collapsing structure)",
        survivor: "Linear growth law preserved",
        destroyed: ["None ‚Äî structure persists unbounded"]
      },
      tau_msc: "NON_COLLAPSING",
      public: true
    },
    {
      id: "fermat",
      title: "Fermat Spiral",
      phi: "Parabolic recursion: r = ¬±‚àöŒ∏",
      psi: "Dual-branch symmetry",
      tau: "Mild damping",
      operator_xii: {
        type: "Symmetry class retention",
        survivor: "Parabolic geometry (branch structure)",
        destroyed: ["Branch distinction", "Absolute orientation"]
      },
      tau_msc: "GEOMETRIC_SURVIVOR",
      public: true
    },
    {
      id: "rule110",
      title: "Cellular Automaton Rule 110",
      phi: "Local binary recursion (1D CA rule)",
      psi: "Emergent long-range structure",
      tau: "Persistent complexity",
      operator_xii: {
        type: "Universality retention",
        survivor: "Computational structures (gliders, interactions)",
        destroyed: ["Random initial noise", "Transient artifacts"]
      },
      tau_msc: "COMPUTATIONAL_SURVIVOR",
      public: false
    },
    {
      id: "collatz",
      title: "Collatz System",
      phi: "Piecewise nonlinear recursion: n ‚Üí n/2 (even), n ‚Üí 3n+1 (odd)",
      psi: "Partial regularity (empirical patterns)",
      tau: "High curvature; expansion/contraction cycles",
      operator_xii: {
        type: "Unresolved collapse",
        survivor: "4 ‚Üí 2 ‚Üí 1 cycle (empirical, unproven)",
        destroyed: ["Large-n excursions (unproven destruction)"]
      },
      tau_msc: "UNDECIDABLE_OPEN",
      public: false
    },
    {
      id: "prime_spiral",
      title: "Prime Number Spiral (Ulam)",
      phi: "Integer embedding recursion (spiral layout)",
      psi: "Arithmetic constraints (prime distribution)",
      tau: "Weak structural damping",
      operator_xii: {
        type: "Pattern retention",
        survivor: "Diagonal structures (visual patterns)",
        destroyed: ["Uniform randomness assumption", "Density prediction"]
      },
      tau_msc: "PATTERN_SURVIVOR",
      public: false
    }
  ]
};

// ============================================================================
// œÑ-MSC CLASS DESCRIPTIONS
// ============================================================================

const MSC_DESCRIPTIONS = {
  CONVERGENT_ATTRACTOR: "System collapses to a unique scalar or ratio invariant. All transients are destroyed; survivor is structurally stable.",
  CHAOTIC_SURVIVOR: "Bounded chaos survives collapse. Periodicity and predictability are destroyed, but the attractor structure persists.",
  FRACTAL_SURVIVOR: "Fractal boundary or set survives as the invariant structure. Interior and exterior points are classified; boundary has infinite detail.",
  UNIVERSAL_ATTRACTOR: "Universal scaling constant emerges from bifurcation cascade. Independent of initial conditions or specific system parameters.",
  META_ATTRACTOR: "Meta-level classification over an ensemble of systems. Survivor is a boundary in parameter space separating qualitative behaviors.",
  GEOMETRIC_ATTRACTOR: "Geometric invariant (angle, ratio, packing law) survives. Absolute scale is destroyed.",
  GEOMETRIC_SURVIVOR: "Geometric symmetry class survives. Specific orientations or branch identities are destroyed.",
  STRUCTURAL_SURVIVOR: "Growth law or asymptotic form survives. Exact values at finite steps are destroyed.",
  COMPUTATIONAL_SURVIVOR: "Computational universality (Turing-completeness) survives. Random noise and transient patterns are destroyed.",
  PATTERN_SURVIVOR: "Visual or structural patterns survive. Density predictions or uniform distributions are destroyed.",
  NON_COLLAPSING: "System does not collapse to an invariant. Growth law persists unbounded; no attractor forms.",
  UNDECIDABLE_OPEN: "Collapse behavior is structurally unresolved. Empirical observations exist but are not proven. UNNS-open question."
};

// ============================================================================
// œÑ-MSC CLASS STYLING
// ============================================================================

const MSC_CLASS_MAP = {
  CONVERGENT_ATTRACTOR: "convergent",
  CHAOTIC_SURVIVOR: "chaotic",
  FRACTAL_SURVIVOR: "fractal",
  UNIVERSAL_ATTRACTOR: "convergent",
  META_ATTRACTOR: "geometric",
  GEOMETRIC_ATTRACTOR: "geometric",
  GEOMETRIC_SURVIVOR: "geometric",
  STRUCTURAL_SURVIVOR: "convergent",
  COMPUTATIONAL_SURVIVOR: "computational",
  PATTERN_SURVIVOR: "fractal",
  NON_COLLAPSING: "non-collapsing",
  UNDECIDABLE_OPEN: "undecidable"
};

// ============================================================================
// UI CONTROLLER
// ============================================================================

const UI = {
  selector: document.getElementById('systemSelector'),
  output: document.getElementById('output'),
  warningBanner: document.getElementById('warningBanner'),
  mscFilter: document.getElementById('mscFilter'),
  currentFilter: 'all',
  
  init() {
    this.populateSelector();
    this.setupEventListeners();
    this.loadFromHash();
  },
  
  setupEventListeners() {
    // System selector
    this.selector.addEventListener('change', (e) => {
      this.renderSystem(e.target.value);
      this.updateHash(e.target.value);
    });
    
    // œÑ-MSC filter buttons
    this.mscFilter.addEventListener('click', (e) => {
      if (e.target.classList.contains('filter-btn')) {
        this.applyFilter(e.target.dataset.filter);
      }
    });
    
    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowDown' || e.key === 'ArrowUp') {
        e.preventDefault();
        this.navigateSelector(e.key === 'ArrowDown' ? 1 : -1);
      }
    });
    
    // Hash change (back/forward navigation)
    window.addEventListener('hashchange', () => this.loadFromHash());
  },
  
  populateSelector() {
    // Separate public and research systems
    const publicSystems = OPERATOR_REGISTRY.systems.filter(s => s.public);
    const researchSystems = OPERATOR_REGISTRY.systems.filter(s => !s.public);
    
    // Add public systems
    if (publicSystems.length > 0) {
      const publicGroup = document.createElement('optgroup');
      publicGroup.label = 'Public Systems';
      publicSystems.forEach(system => {
        const option = document.createElement('option');
        option.value = system.id;
        option.textContent = system.title;
        publicGroup.appendChild(option);
      });
      this.selector.appendChild(publicGroup);
    }
    
    // Add research-only systems
    if (researchSystems.length > 0) {
      const researchGroup = document.createElement('optgroup');
      researchGroup.label = 'Research-Only Systems (‚ö†Ô∏è Gated)';
      researchSystems.forEach(system => {
        const option = document.createElement('option');
        option.value = system.id;
        option.textContent = `‚ö†Ô∏è ${system.title}`;
        researchGroup.appendChild(option);
      });
      this.selector.appendChild(researchGroup);
    }
  },
  
  applyFilter(filterType) {
    this.currentFilter = filterType;
    
    // Update button states
    this.mscFilter.querySelectorAll('.filter-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.filter === filterType);
    });
    
    // Filter options in selector
    const allOptions = this.selector.querySelectorAll('option');
    allOptions.forEach(option => {
      if (!option.value) return; // Skip placeholder
      
      const system = OPERATOR_REGISTRY.systems.find(s => s.id === option.value);
      if (!system) return;
      
      let shouldShow = false;
      
      if (filterType === 'all') {
        shouldShow = true;
      } else if (filterType === 'GEOMETRIC') {
        // Geometric group includes multiple œÑ-MSC classes
        shouldShow = system.tau_msc.includes('GEOMETRIC') || system.tau_msc.includes('PATTERN');
      } else if (filterType === 'OTHER') {
        // Other includes non-standard classifications
        const standardClasses = ['CONVERGENT_ATTRACTOR', 'CHAOTIC_SURVIVOR', 'FRACTAL_SURVIVOR', 
                                 'UNDECIDABLE_OPEN', 'GEOMETRIC_ATTRACTOR', 'GEOMETRIC_SURVIVOR', 
                                 'PATTERN_SURVIVOR'];
        shouldShow = !standardClasses.includes(system.tau_msc);
      } else {
        shouldShow = system.tau_msc === filterType;
      }
      
      option.style.display = shouldShow ? '' : 'none';
    });
  },
  
  navigateSelector(direction) {
    const options = Array.from(this.selector.options).filter(opt => 
      opt.value && opt.style.display !== 'none'
    );
    const currentIndex = options.findIndex(opt => opt.value === this.selector.value);
    
    if (currentIndex === -1 && options.length > 0) {
      // No selection, jump to first
      this.selector.value = options[0].value;
    } else {
      // Move up or down
      const newIndex = currentIndex + direction;
      if (newIndex >= 0 && newIndex < options.length) {
        this.selector.value = options[newIndex].value;
      }
    }
    
    this.selector.dispatchEvent(new Event('change'));
  },
  
  updateHash(systemId) {
    if (systemId) {
      window.location.hash = systemId;
    } else {
      history.replaceState(null, null, ' ');
    }
  },
  
  loadFromHash() {
    const hash = window.location.hash.slice(1);
    if (hash) {
      const system = OPERATOR_REGISTRY.systems.find(s => s.id === hash);
      if (system) {
        this.selector.value = hash;
        this.renderSystem(hash);
      }
    }
  },
  
  renderSystem(systemId) {
    if (!systemId) {
      this.output.innerHTML = `
        <div class="placeholder">
          <div class="placeholder-icon">‚öôÔ∏è</div>
          <div>Select a system above to view its operator decomposition</div>
        </div>
      `;
      this.warningBanner.classList.remove('active');
      return;
    }
    
    const system = OPERATOR_REGISTRY.systems.find(s => s.id === systemId);
    if (!system) return;
    
    // Show warning for research-only systems
    if (!system.public) {
      this.warningBanner.classList.add('active');
    } else {
      this.warningBanner.classList.remove('active');
    }
    
    this.output.innerHTML = this.buildSystemView(system);
    
    // Attach export button handler
    const exportBtn = document.getElementById('exportSystem');
    if (exportBtn) {
      exportBtn.addEventListener('click', () => this.exportSystem(system));
    }
    
    // Attach cross-reference click handlers
    document.querySelectorAll('.cross-ref-link').forEach(link => {
      link.addEventListener('click', (e) => {
        e.preventDefault();
        const targetId = link.dataset.systemId;
        this.selector.value = targetId;
        this.renderSystem(targetId);
        this.updateHash(targetId);
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });
  },
  
  computeCrossReferences(system) {
    const refs = {
      identicalCollapse: [],
      sameMSC: [],
      sharedMechanism: []
    };
    
    OPERATOR_REGISTRY.systems.forEach(other => {
      if (other.id === system.id) return;
      
      // Identical collapse (same survivor)
      if (system.operator_xii.survivor === other.operator_xii.survivor) {
        refs.identicalCollapse.push(other);
      }
      
      // Same œÑ-MSC class
      if (system.tau_msc === other.tau_msc && 
          !refs.identicalCollapse.includes(other)) {
        refs.sameMSC.push(other);
      }
      
      // Shared Operator XII mechanism
      if (system.operator_xii.type === other.operator_xii.type && 
          !refs.identicalCollapse.includes(other) && 
          !refs.sameMSC.includes(other)) {
        refs.sharedMechanism.push(other);
      }
    });
    
    return refs;
  },
  
  buildCrossReferencesHTML(system) {
    const refs = this.computeCrossReferences(system);
    const hasAny = refs.identicalCollapse.length > 0 || 
                   refs.sameMSC.length > 0 || 
                   refs.sharedMechanism.length > 0;
    
    if (!hasAny) {
      return `
        <div class="cross-references">
          <div class="cross-ref-title">üîó Collapse-Based Cross-References</div>
          <div class="cross-ref-none">No systems share collapse characteristics with this one.</div>
        </div>
      `;
    }
    
    let html = `
      <div class="cross-references">
        <div class="cross-ref-title">üîó Collapse-Based Cross-References</div>
    `;
    
    if (refs.identicalCollapse.length > 0) {
      html += `
        <div class="cross-ref-group">
          <div class="cross-ref-label">Identical Collapse (same survivor):</div>
          <div class="cross-ref-links">
            ${refs.identicalCollapse.map(s => 
              `<a class="cross-ref-link" data-system-id="${s.id}">${s.title}</a>`
            ).join('')}
          </div>
        </div>
      `;
    }
    
    if (refs.sameMSC.length > 0) {
      html += `
        <div class="cross-ref-group">
          <div class="cross-ref-label">Same œÑ-MSC Class (${system.tau_msc.replace(/_/g, ' ')}):</div>
          <div class="cross-ref-links">
            ${refs.sameMSC.map(s => 
              `<a class="cross-ref-link" data-system-id="${s.id}">${s.title}</a>`
            ).join('')}
          </div>
        </div>
      `;
    }
    
    if (refs.sharedMechanism.length > 0) {
      html += `
        <div class="cross-ref-group">
          <div class="cross-ref-label">Shared Operator XII Mechanism (${system.operator_xii.type}):</div>
          <div class="cross-ref-links">
            ${refs.sharedMechanism.map(s => 
              `<a class="cross-ref-link" data-system-id="${s.id}">${s.title}</a>`
            ).join('')}
          </div>
        </div>
      `;
    }
    
    html += `</div>`;
    return html;
  },
  
  exportSystem(system) {
    const exportData = {
      registry_version: OPERATOR_REGISTRY.version,
      framework: OPERATOR_REGISTRY.framework,
      system: {
        id: system.id,
        title: system.title,
        operators: {
          phi: system.phi,
          psi: system.psi,
          tau: system.tau,
          operator_xii: system.operator_xii
        },
        tau_msc_classification: system.tau_msc,
        access_level: system.public ? "public" : "research-only"
      },
      export_timestamp: new Date().toISOString(),
      citation: `UNNS Operator Registry v${OPERATOR_REGISTRY.version} ‚Äî ${system.title}`
    };
    
    const blob = new Blob([JSON.stringify(exportData, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `UNNS_${system.id}_operator_decomposition.json`;
    a.click();
    URL.revokeObjectURL(url);
  },
  
  buildSystemView(system) {
    const mscClass = MSC_CLASS_MAP[system.tau_msc] || 'convergent';
    const mscDescription = MSC_DESCRIPTIONS[system.tau_msc] || 'Classification pending.';
    
    return `
      <div class="system-info">
        <div class="system-info-title">${system.title}</div>
        <div class="info-grid">
          <div class="info-label">System ID:</div>
          <div class="info-value"><code>${system.id}</code></div>
          <div class="info-label">Access Level:</div>
          <div class="info-value">${system.public ? 'Public' : '‚ö†Ô∏è Research-Only'}</div>
          <div class="info-label">Classification:</div>
          <div class="info-value">${system.tau_msc.replace(/_/g, ' ')}</div>
        </div>
        <button id="exportSystem" class="export-btn">üíæ Export Operator Decomposition (JSON)</button>
      </div>
      
      <div class="timeline-container">
        <div class="panel-title">Operator Pipeline</div>
        <div class="timeline">
          <div class="timeline-line"></div>
          <div class="stage">
            <div class="stage-node phi">Œ¶</div>
            <div class="stage-label">Generation</div>
          </div>
          <div class="stage">
            <div class="stage-node psi">Œ®</div>
            <div class="stage-label">Structure</div>
          </div>
          <div class="stage">
            <div class="stage-node tau">œÑ</div>
            <div class="stage-label">Curvature</div>
          </div>
          <div class="stage">
            <div class="stage-node xii">XII</div>
            <div class="stage-label">Collapse</div>
          </div>
          <div class="stage">
            <div class="stage-node msc">œÑ-MSC</div>
            <div class="stage-label">Classification</div>
          </div>
        </div>
        
        <div class="stage-details">
          <div class="detail-card">
            <div class="detail-header phi">Œ¶ ‚Äî Generation Stage</div>
            <div class="detail-content">${system.phi}</div>
          </div>
          
          <div class="detail-card">
            <div class="detail-header psi">Œ® ‚Äî Structural Stage</div>
            <div class="detail-content">${system.psi}</div>
          </div>
          
          <div class="detail-card">
            <div class="detail-header tau">œÑ ‚Äî Curvature Stage</div>
            <div class="detail-content">${system.tau}</div>
          </div>
          
          <div class="detail-card xii">
            <div class="detail-header xii">Operator XII ‚Äî Collapse Analysis</div>
            <div class="detail-content">
              <strong>Collapse Type:</strong> ${system.operator_xii.type}
              ${system.operator_xii.note ? `<br><strong>Note:</strong> ${system.operator_xii.note}` : ''}
            </div>
          </div>
        </div>
      </div>
      
      <div class="collapse-summary">
        <div class="collapse-title">‚öôÔ∏è Operator XII ‚Äî Collapse Outcome</div>
        <div class="collapse-grid">
          <div class="collapse-label">Survivor:</div>
          <div class="collapse-value survivor">${system.operator_xii.survivor}</div>
          
          <div class="collapse-label">Destroyed:</div>
          <div class="collapse-value destroyed">
            ${Array.isArray(system.operator_xii.destroyed) 
              ? system.operator_xii.destroyed.join(', ') 
              : (system.operator_xii.destroyed || 'N/A')}
          </div>
          
          <div class="collapse-label">Mechanism:</div>
          <div class="collapse-value">${system.operator_xii.type}</div>
        </div>
      </div>
      
      <div class="msc-classification">
        <div class="msc-title">œÑ-MSC Final Classification</div>
        <div class="msc-badge ${mscClass}">
          ${system.tau_msc.replace(/_/g, ' ')}
        </div>
        <div class="msc-description">${mscDescription}</div>
      </div>
      
      ${this.buildCrossReferencesHTML(system)}
    `;
  }
};

// ============================================================================
// INITIALIZE
// ============================================================================

document.addEventListener('DOMContentLoaded', () => {
  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
  console.log('UNNS Operator Registry v2.0 | Phase-B (Enhanced)');
  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
  console.log(`‚úì Loaded ${OPERATOR_REGISTRY.systems.length} systems`);
  console.log(`‚úì Public: ${OPERATOR_REGISTRY.systems.filter(s => s.public).length}`);
  console.log(`‚úì Research: ${OPERATOR_REGISTRY.systems.filter(s => !s.public).length}`);
  console.log('‚úì Features: Hash navigation, œÑ-MSC filter, cross-refs, export, keyboard nav');
  console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
  
  UI.init();
});
  </script>
</body>
</html>
